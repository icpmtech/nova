<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <meta name="description" content="Nova Hub - Explore Nova projects visually and quickly">
  <title>Nova Hub</title>

  <!-- PWA Manifest & Theme -->
  <link rel="manifest" href="/manifest.json" />
  <meta name="theme-color" content="#00FFFF" />
  <link rel="apple-touch-icon" href="/icons/icon-192.png" />

  <!-- SEO Meta Tags -->
  <meta name="keywords" content="Nova Hub, Nova projects, finance tools, search platforms, LLM platforms, analytics">
  <meta name="author" content="pedro martins & cantinhode.net">
  <meta property="og:title" content="Nova Hub & cantinhode.net">
  <meta property="og:description" content="Explore Nova projects visually and quickly">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://nova-hub.netlify.app/">
  <meta property="og:image" content="https://nova-hub.netlify.app/logo.png">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Nova Hub">
  <meta name="twitter:description" content="Explore Nova projects visually and quickly">
  <meta name="twitter:image" content="https://nova-hub.netlify.app/logo.png">

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-8M25SCL0G0"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}  
    gtag('js', new Date());
    gtag('config', 'G-8M25SCL0G0');
  </script>

  <!-- Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "Nova Hub",
    "url": "https://nova-hub.netlify.app/",
    "potentialAction": {
      "@type": "SearchAction",
      "target": "https://nova-hub.netlify.app/?search={search_term_string}",
      "query-input": "required name=search_term_string"
    }
  }
  </script>

  <!-- Main Stylesheet -->

<link rel="stylesheet" href="app.css">
  <!-- Custom Links Panel & Toggle Styles -->
  <style>
    .link-panel {
      position: fixed; top: 0; right: 0;
      width: 280px; height: 100%;
      background: #f9f9f9; border-left: 1px solid #ccc;
      padding: 16px; box-shadow: -2px 0 5px rgba(0,0,0,0.1);
      overflow-y: auto; z-index: 1000;
      transform: translateX(0); transition: transform 0.3s ease;
    }
    .link-panel.hidden { transform: translateX(100%); }
    .link-toggle {
      position: fixed; top: 20px; right: 20px; z-index: 1100;
      background: #00cccc; border: none;
      padding: 8px 12px; color: #fff; font-size: 0.9rem;
      border-radius: 4px; cursor: pointer;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    .link-panel h2 { margin-top: 0; font-size: 1.2rem; }
    .link-panel form { display: flex; flex-direction: column; gap: 8px; margin-bottom: 16px; }
    .link-panel input { padding: 8px; font-size: 0.9rem; border: 1px solid #aaa; border-radius: 4px; }
    .link-panel button.form-add {
      padding: 8px; font-size: 0.9rem; border: none;
      background: #00cccc; color: #fff; border-radius: 4px; cursor: pointer;
    }
    .link-panel ul { list-style: none; padding: 0; }
    .link-panel li {
      display: flex; justify-content: space-between;
      align-items: center; margin-bottom: 8px;
    }
    .link-panel li a {
      flex-grow: 1; text-decoration: none;
      color: #007acc; margin-right: 8px;
    }
    .link-panel li button {
      background: none; border: none; cursor: pointer;
      font-size: 1rem; color: #888;
    }
  </style>
</head>
<body>
  <!-- Mobile menu toggle -->
  <button class="menu-toggle" id="menuToggle" aria-label="Toggle Menu">‚ò∞</button>

  <!-- Sidebar Navigation -->
  <aside id="sidebar" aria-label="Main Navigation">
    <!-- ... your nav icons ... -->
  </aside>

  <!-- Main Content -->
  <main id="main-content">
    <header>
      <h1 id="main-title">Nova Hub</h1>
      <p id="subtitle">Explora os projetos Nova de forma visual e r√°pida</p>
      <div class="language-switcher" role="group" aria-label="Language Selection">
        <button class="language-btn active" data-lang="pt" aria-pressed="true">PT</button>
        <button class="language-btn" data-lang="en" aria-pressed="false">EN</button>
        <button class="language-btn" data-lang="es" aria-pressed="false">ES</button>
        <button class="language-btn" data-lang="fr" aria-pressed="false">FR</button>
      </div>
    </header>
    <div id="content">
      <div class="loading-container" id="loading">
        <div class="loading-spinner" aria-label="Loading content"></div>
      </div>
    </div>
  </main>

  <!-- Scroll to top & overlay -->
  <button class="scroll-top" id="scrollTop" aria-label="Scroll to top">‚Üë</button>
  <div class="overlay" id="overlay"></div>

  <!-- Toggle Links Panel Button -->
  <button id="link-toggle" class="link-toggle">Links</button>

  <!-- Custom Links Panel -->
  <aside id="link-panel" class="link-panel" aria-label="Custom Links Panel">
    <h2>Your Links</h2>
    <form id="link-form">
      <input type="text" id="link-title" placeholder="Title" required />
      <input type="url"  id="link-url"   placeholder="URL"   required />
      <button type="submit" class="form-add">Add</button>
    </form>
    <ul id="link-list"></ul>
  </aside>

  

  <!-- CRUD Panel & Toggle Logic -->
  <script>
    const linkStorageKey = 'custom-links';
    const safeStorage = {
      data: {},
      getItem(key) {
        try { return localStorage.getItem(key); }
        catch { return this.data[key] || null; }
      },
      setItem(key, value) {
        try { localStorage.setItem(key, value); }
        catch { this.data[key] = value; }
      }
    };

    // CRUD functions
    function loadLinks() {
      const raw = safeStorage.getItem(linkStorageKey);
      return raw ? JSON.parse(raw) : [];
    }
    function saveLinks(links) {
      safeStorage.setItem(linkStorageKey, JSON.stringify(links));
    }
    function renderLinks() {
      const list = document.getElementById('link-list');
      list.innerHTML = '';
      loadLinks().forEach((link, i) => {
        const li = document.createElement('li');
        const a = document.createElement('a');
        a.href = link.url;
        a.textContent = link.title;
        a.target = '_blank';
        const edit = document.createElement('button');
        edit.textContent = '‚úèÔ∏è';
        edit.onclick = () => editLink(i);
        const del = document.createElement('button');
        del.textContent = 'üóëÔ∏è';
        del.onclick = () => deleteLink(i);
        li.append(a, edit, del);
        list.appendChild(li);
      });
    }
    function addLink(title, url) {
      const links = loadLinks();
      links.push({ title, url });
      saveLinks(links);
      renderLinks();
    }
    function editLink(i) {
      const links = loadLinks(), ln = links[i];
      const nt = prompt('Edit title:', ln.title);
      const nu = prompt('Edit URL:',   ln.url);
      if (nt && nu) {
        links[i] = { title: nt, url: nu };
        saveLinks(links);
        renderLinks();
      }
    }
    function deleteLink(i) {
      const links = loadLinks();
      if (confirm(`Delete "${links[i].title}"?`)) {
        links.splice(i, 1);
        saveLinks(links);
        renderLinks();
      }
    }

    // Form handling & toggle logic
    document.getElementById('link-form').addEventListener('submit', e => {
      e.preventDefault();
      addLink(
        document.getElementById('link-title').value.trim(),
        document.getElementById('link-url').value.trim()
      );
      document.getElementById('link-title').value = '';
      document.getElementById('link-url').value   = '';
    });

    document.addEventListener('DOMContentLoaded', () => {
      renderLinks();

      const toggleBtn = document.getElementById('link-toggle');
      const panel     = document.getElementById('link-panel');

      // Toggle visibility
      toggleBtn.addEventListener('click', e => {
        e.stopPropagation();
        panel.classList.toggle('hidden');
      });

      // Close on outside click
      document.addEventListener('click', e => {
        if (!panel.contains(e.target) && !toggleBtn.contains(e.target)) {
          panel.classList.add('hidden');
        }
      });

      // Close on Escape
      document.addEventListener('keydown', e => {
        if (e.key === 'Escape') {
          panel.classList.add('hidden');
        }
      });
    });
  </script>

  <!-- Translations, Categories & Core Page Logic -->
  <script>
    const translations = {
      en: {
        mainTitle: "Nova Hub",
        subtitle : "Explore Nova projects visually and quickly",
        sectionTitles : {
          "Finance Tools": "Finance Tools",
          "Search Platforms": "Search Platforms",
          "LLM Platforms" : "LLM Platforms",
          "Analytics & More": "Analytics & More"
        },
        controls: { fullscreen: "Fullscreen", minimize: "Minimize" },
        errors:   { loading: "Failed to load content", retry: "Retry" }
      },
      pt: {
        mainTitle: "Nova Hub",
        subtitle: "Explora os projetos Nova de forma visual e r√°pida",
        sectionTitles: {
          "Finance Tools": "Ferramentas Financeiras",
          "Search Platforms": "Plataformas de Busca",
          "LLM Platforms": "Plataformas LLM",
          "Analytics & More": "An√°lises e Mais"
        },
        controls: { fullscreen: "Tela Cheia", minimize: "Minimizar" },
        errors:   { loading: "Falha ao carregar conte√∫do", retry: "Tentar novamente" }
      },
      es: {
        mainTitle: "Nova Hub",
        subtitle: "Explora los proyectos Nova de forma visual y r√°pida",
        sectionTitles: {
          "Finance Tools": "Herramientas Financieras",
          "Search Platforms": "Plataformas de B√∫squeda",
          "LLM Platforms": "Plataformas LLM",
          "Analytics & More": "Anal√≠ticas y M√°s"
        },
        controls: { fullscreen: "Pantalla Completa", minimize: "Minimizar" },
        errors:   { loading: "Error al cargar contenido", retry: "Reintentar" }
      },
      fr: {
        mainTitle: "Nova Hub",
        subtitle: "Explorez les projets Nova visuellement et rapidement",
        sectionTitles: {
          "Finance Tools": "Outils Financiers",
          "Search Platforms": "Plateformes de Recherche",
          "LLM Platforms": "Plateformes LLM",
          "Analytics & More": "Analyses et Plus"
        },
        controls: { fullscreen: "Plein √âcran", minimize: "R√©duire" },
        errors:   { loading: "√âchec du chargement du contenu", retry: "R√©essayer" }
      }
    };

    const categories = {
      "Finance Tools": [
        { title: "Nova Charts", url: "https://nova-charts.netlify.app/", description: "Interactive financial charts and analytics" },
        { title: "Nova Finance Hub", url: "https://nova-finance-hub.netlify.app/", description: "Comprehensive financial management tools" },
        { title: "Market Wallet", url: "https://market-wallet.netlify.app/", description: "Track and manage your investment portfolio" },
        { title: "Agent Finance Demo", url: "https://agent-finance-demo.netlify.app/", description: "AI-powered financial assistant" }
      ],
      "Search Platforms": [
        { title: "Nova Search Dividends - All", url: "https://nova-search-dividends.netlify.app/all.html", description: "Complete dividend information search" },
        { title: "Nova Search Dividends", url: "https://nova-search-dividends.netlify.app/", description: "Dividend-focused search platform" },
        { title: "Nova Search Stock", url: "https://nova-search-stock.netlify.app/", description: "Stock information search engine" },
        { title: "NovaSearch", url: "https://novasearch.app/", description: "Main search platform for Nova ecosystem" },
        { title: "NovaSearch Hub", url: "https://novasearch.app/hubsearch", description: "Centralized search hub for all Nova resources" }
      ],
      "LLM Platforms": [
        { title: "ChatGPT", url: "https://chat.openai.com", description: "OpenAI's conversational AI" },
        { title: "Google Gemini", url: "https://gemini.google.com", description: "Google's multimodal AI assistant" },
        { title: "Claude AI", url: "https://claude.ai", description: "Anthropic's helpful AI assistant" },
        { title: "Microsoft Copilot", url: "https://copilot.microsoft.com", description: "Microsoft's AI companion" },
        { title: "Perplexity AI", url: "https://perplexity.ai", description: "AI-powered search and answers" },
        { title: "Chat Cantinho", url: "https://chat-cantinho.vercel.app/", description: "Custom chat interface for Nova ecosystem" }
      ],
      "Analytics & More": [
        { title: "Market Analytics Hub", url: "https://marketanalyticshubapp.azurewebsites.net/", description: "Advanced market analytics and insights" },
        { title: "Cantinho de Net", url: "https://cantinhode.net/", description: "Community platform for Nova users" },
        { title: "Example Site", url: "https://example.com", description: "Demo site for testing purposes" },
        { title: "Wikipedia", url: "https://wikipedia.org", description: "Free online encyclopedia" },
        { title: "OpenAI", url: "https://openai.com", description: "AI research and deployment" },
        { title: "GitHub", url: "https://github.com", description: "Code hosting platform" }
      ]
    };

    // DOM references & core logic
    const contentEl = document.getElementById("content"),
          sidebarEl = document.getElementById("sidebar"),
          menuToggle = document.getElementById("menuToggle"),
          scrollTop = document.getElementById("scrollTop"),
          overlay   = document.getElementById("overlay"),
          loading   = document.getElementById("loading"),
          navLinks  = document.querySelectorAll(".nav-icon"),
          langButtons = document.querySelectorAll(".language-btn");

    let currentLang = localStorage.getItem("novaagg-lang") || "pt";

    function updateTooltips(lang) {
      navLinks.forEach(link => {
        const attr = `data-tooltip-${lang}`;
        if (link.hasAttribute(attr)) {
          link.setAttribute("data-tooltip", link.getAttribute(attr));
          link.setAttribute("aria-label", link.getAttribute(attr));
        }
      });
    }

    function changeLanguage(lang) {
      if (lang === currentLang) return;
      currentLang = lang;
      langButtons.forEach(btn => {
        const active = btn.dataset.lang === lang;
        btn.classList.toggle("active", active);
        btn.setAttribute("aria-pressed", active);
      });
      const mt = document.getElementById("main-title"),
            st = document.getElementById("subtitle");
      mt.style.opacity = st.style.opacity = "0";
      setTimeout(() => {
        mt.textContent = translations[lang].mainTitle;
        st.textContent = translations[lang].subtitle;
        mt.style.opacity = st.style.opacity = "1";
      }, 200);
      updateTooltips(lang);
      document.querySelectorAll(".controls button").forEach(b => {
        const isFull = ["Fullscreen","Tela Cheia","Pantalla Completa","Plein √âcran"]
          .includes(b.textContent);
        b.textContent = isFull
          ? translations[lang].controls.fullscreen
          : translations[lang].controls.minimize;
      });
      localStorage.setItem("novaagg-lang", lang);
      document.documentElement.lang = lang;
    }

    langButtons.forEach(btn =>
      btn.addEventListener("click", () => changeLanguage(btn.dataset.lang))
    );

    menuToggle.addEventListener("click", () => {
      sidebarEl.classList.toggle("active");
      document.body.classList.toggle("sidebar-open");
      menuToggle.setAttribute("aria-expanded", sidebarEl.classList.contains("active"));
    });

    function createFrame(site, category) {
      const frame = document.createElement("div");
      frame.className = "frame";
      frame.dataset.category = category;

      // controls
      const ctr = document.createElement("div");
      ctr.className = "controls";
      ctr.setAttribute("aria-label","Frame controls");
      const bFull = document.createElement("button");
      bFull.textContent = translations[currentLang].controls.fullscreen;
      bFull.setAttribute("aria-label", `Fullscreen ${site.title}`);
      bFull.onclick = e => {
        e.preventDefault();
        frame.classList.add("fullscreen");
        overlay.classList.add("active");
        const ifr = frame.querySelector("iframe");
        if (ifr && ifr.dataset.src && !ifr.src) ifr.src = ifr.dataset.src;
        frame.setAttribute("tabindex","-1");
        frame.focus();
      };
      const bMin = document.createElement("button");
      bMin.textContent = translations[currentLang].controls.minimize;
      bMin.setAttribute("aria-label", `Close fullscreen ${site.title}`);
      bMin.onclick = e => {
        e.preventDefault();
        frame.classList.remove("fullscreen");
        overlay.classList.remove("active");
      };
      ctr.append(bFull, bMin);

      // iframe
      const ifr = document.createElement("iframe");
      ifr.dataset.src = site.url;
      ifr.loading = "lazy";
      ifr.title   = site.title;
      ifr.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms");
      ifr.setAttribute("aria-label",`${site.title} content`);

      // title
      const tdiv = document.createElement("div");
      tdiv.className = "site-title";
      tdiv.textContent = site.title;
      if (site.description) {
        tdiv.title = site.description;
        tdiv.setAttribute("aria-label", `${site.title}: ${site.description}`);
      }

      frame.append(ctr, ifr, tdiv);
      return frame;
    }

    function generateContent() {
      loading.style.display = "none";
      Object.entries(categories).forEach(([cat, sites]) => {
        const id = cat.toLowerCase().replace(/\s+/g,"-");
        const sec = document.createElement("section");
        sec.setAttribute("aria-labelledby", id);
        const h2 = document.createElement("h2");
        h2.id = id;
        h2.className = "section-title";
        h2.textContent = translations[currentLang].sectionTitles[cat];
        const container = document.createElement("div");
        container.className = "container";
        container.setAttribute("role","list");
        container.setAttribute("aria-label", translations[currentLang].sectionTitles[cat]);
        sites.forEach(site => {
          const f = createFrame(site, cat);
          f.setAttribute("role","listitem");
          container.append(f);
        });
        sec.append(h2, container);
        contentEl.append(sec);
      });
      initObservers();
    }

    function debounce(fn, wait) {
      let t;
      return (...a) => {
        clearTimeout(t);
        t = setTimeout(() => fn.apply(this, a), wait);
      };
    }

    function initObservers() {
      // lazy load
      const lazyObs = new IntersectionObserver(entries => {
        entries.forEach(ent => {
          if (ent.isIntersecting) {
            const f = ent.target;
            const ifr = f.querySelector("iframe");
            if (ifr && ifr.dataset.src && !ifr.src) ifr.src = ifr.dataset.src;
            lazyObs.unobserve(f);
          }
        });
      }, { rootMargin:"100px", threshold:0.1 });
      document.querySelectorAll(".frame").forEach(f => lazyObs.observe(f));

      // section highlight
      const secObs = new IntersectionObserver(entries => {
        entries.forEach(ent => {
          if (ent.isIntersecting && ent.intersectionRatio > 0.3) {
            const sid = ent.target.querySelector(".section-title").id;
            document.querySelectorAll(".nav-icon").forEach(n => {
              const act = n.getAttribute("href") === `#${sid}`;
              n.classList.toggle("active", act);
              if (act) n.setAttribute("aria-current","page");
              else      n.removeAttribute("aria-current");
            });
          }
        });
      }, { threshold:[0.1,0.3,0.5], rootMargin:"-100px 0 -100px 0" });
      document.querySelectorAll("section").forEach(s => secObs.observe(s));
    }

    const handleScroll = debounce(() => {
      scrollTop.classList.toggle("visible", window.scrollY > 300);
    }, 100);
    window.addEventListener("scroll", handleScroll);
    scrollTop.addEventListener("click", () => window.scrollTo({ top: 0, behavior: "smooth" }));
    overlay.addEventListener("click", () => {
      document.querySelector(".frame.fullscreen")?.classList.remove("fullscreen");
      overlay.classList.remove("active");
    });
    document.addEventListener("keydown", e => {
      if (e.key === "Escape") {
        document.querySelector(".frame.fullscreen")?.classList.remove("fullscreen");
        overlay.classList.remove("active");
      }
    });

    document.addEventListener("DOMContentLoaded", () => {
      changeLanguage(currentLang);
      generateContent();
    });

    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("/service-worker.js")
      .then(() => console.log("Service Worker registado!"));
    }
  </script>
</body>
</html>
